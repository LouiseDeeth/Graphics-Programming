<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Canvas</title>
    <style type="text/css">
        body {
            background-color: white;
        }

        canvas {
            border: 1px solid #000000;
        }
    </style>
</head>

<body>
    <h1>Louise Deeth</h1>

    <canvas id="canvas-for-ball"></canvas>

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <script type="text/javascript">
        // Gets a handle to the element with id canvasOne.
        var canvas = document.getElementById("canvas-for-ball");
        //Set height and width of canvas
        canvas.height = 400;
        canvas.width = 500;
        // Get a 2D context for the canvas.
        var ctx = canvas.getContext("2d");

        class matchBall {
            constructor(xPos, yPos, xSpeed, ySpeed, radius = 20) {
                this.xPos = xPos;
                this.yPos = yPos;
                this.xSpeed = xSpeed;
                this.ySpeed = ySpeed;
                this.initialXSpeed = xSpeed;
                this.initialYSpeed = ySpeed;
                this.radius = radius; //the radius of the peace sign
                this.rotation = 0; //initial rotation in radians
                this.rotationSpeed = 0.1; // how fast the rotation happens  
                this.isRotatingClockwise = true; //initial direction of rotation
            }

            //Convert degrees to radians
            //To change from radians to degrees, you need to multiply the number of radians by 180/π.
            //To convert from degrees to radians, multiply the number of degrees by π/180.
            toRadians(degrees) {
                return degrees * Math.PI / 180;
            }

            //Draw method
            draw() {
                ctx.save();
                ctx.translate(this.xPos, this.yPos);
                ctx.rotate(this.rotation);

                //draw the outer circle
                ctx.beginPath();
                ctx.arc(0, 0, this.radius, 0, 2 * Math.PI);//outer circle
                ctx.stroke();

                //draw the centre line
                ctx.beginPath();
                ctx.moveTo(0, -this.radius);
                ctx.lineTo(0, this.radius);
                ctx.stroke();

                //draw the left line
                let angleL = this.toRadians(135);
                let xLeft = this.radius * Math.cos(angleL);
                let yLeft = this.radius * Math.sin(angleL);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(xLeft, yLeft);
                ctx.stroke();

                //draw the right line
                let angleR = this.toRadians(45);
                let xRight = this.radius * Math.cos(angleR);
                let yRight = this.radius * Math.sin(angleR);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(xRight, yRight);
                ctx.stroke();

                this.rotation += (this.isRotatingClockwise ? this.rotationSpeed : -this.rotationSpeed);
                ctx.restore();
            }

            //Check if ball touches paddles
            checkPaddleHit(PaddleBall) {
                if (
                    this.yPos + this.radius > PaddleBall.yPos - PaddleBall.radius && 
                    this.yPos - this.radius < PaddleBall.yPos + PaddleBall.radius && 
                    this.xPos + this.radius > PaddleBall.xPos - PaddleBall.radius &&
                    this.xPos - this.radius < PaddleBall.xPos + PaddleBall.radius
                ) {
                    this.xSpeed = -this.xSpeed; //reverse x direction

                    // move ball away from paddle
                    if (this.xSpeed > 0) {
                        this.xPos = PaddleBall.xPos + PaddleBall.radius + this.radius + 5;
                    }
                    else {
                        this.xPos = PaddleBall.xPos - PaddleBall.radius - this.radius - 5;
                    }

                    // check if ball is stuch behind paddle amd fix
                    if (this.xPos < 0 || this.xPos > canvas.width) {
                        this.xSpeed = this.xSpeed; //reverse x direction again
                        this.xPos = (this.xPos < 0) ? this.radius : canvas.width - this.radius;
                    }
                }
            }

            //Increase speed of ball
            increaseSpeed() {
                this.xSpeed *= 1.1; //increase x speed by 10%
                this.ySpeed *= 1.1; //increase y speed by 10%
            }

            //move method for ball
            move(lPaddleBall, rPaddleBall) {

                // Update the y location.
                this.yPos += this.ySpeed;
                this.xPos += this.xSpeed;

                //Bounce off the top & bottom
                if (this.yPos > (canvas.height - this.radius) || this.yPos < this.radius) {
                    this.ySpeed = this.ySpeed * -1; //reverse y direction
                    this.isRotatingClockwise = !this.isRotatingClockwise; //reverse direction of rotation 
                }

                //Bounce off the left & right
                if (this.xPos > (canvas.width - this.radius) || this.xPos < this.radius) {
                    this.xSpeed = this.xSpeed * -1; //reverse x direction
                }
                // Bounce off paddles
                this.checkPaddleHit(lPaddleBall);
                this.checkPaddleHit(rPaddleBall);
            }
        }

        class PaddleBall {
            constructor(xPos, yPos, radius = 30) {
                this.xPos = xPos;
                this.yPos = yPos;
                this.radius = radius; //the radius of the PaddleBalls
                this.ySpeed = 25;
            }

            //Draw method
            draw() {
                ctx.save();
                ctx.translate(this.xPos, this.yPos);
                //draw the outer circle
                ctx.beginPath();
                ctx.arc(0, 0, this.radius, 0, 2 * Math.PI);//outer circle
                ctx.stroke();
                ctx.restore();
            }

            move(direction) {
                if (direction === 'up' && this.yPos - this.radius > 0) {
                    this.yPos -= this.ySpeed;
                }
                else if (direction === 'down' && this.yPos + this.radius < canvas.height) {
                    this.yPos += this.ySpeed;
                }
            }

            moveTo(y) {
                this.yPos = Math.min(Math.max(this.radius, y), canvas.height - this.radius);
            }
        }

        //Create the match ball with initial positions and speed
        var b1 = new matchBall(canvas.width / 2, canvas.height / 2, 2, 1);
        //Create right ball
        var rPaddleBall = new PaddleBall(canvas.width - 30, canvas.height / 2, 30);
        //Create left ball
        var lPaddleBall = new PaddleBall(30, canvas.height / 2, 30);

        // A function to repeat every time the animation loops.
        function repeatme() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); //Clear the canvas
            b1.draw(); // Draw the match ball (stroked, not filled).
            b1.move(lPaddleBall, rPaddleBall); // Move the ball with ball paddles
            lPaddleBall.draw();// Draw the left paddle ball
            rPaddleBall.draw();// Draw the right paddle ball
            window.requestAnimationFrame(repeatme);
        }

        // Get the animation going.
        repeatme();

        canvas.addEventListener("mousemove", function (event) {
            var mouse = {
                //x: event.clientX - canvas.offsetLeft,
                y: event.clientY - canvas.offsetTop
            }
            //Move the paddleBall to the y coordinate
            rPaddleBall.moveTo(mouse.y);
        });

        //keypresses with jQuery
        $(document.body).on('keydown', function (e) {
            console.log(e.which);
            switch (e.which) {
                // key code for up arrow for the right paddle ball
                case 38:
                    rPaddleBall.move('up');
                    console.log('up arrow key pressed!');
                    break;

                // key code for down arrow for the right paddle ball
                case 40:
                    rPaddleBall.move('down');
                    console.log('down arrow key pressed!');
                    break;

                // key code for up arrow for the left paddle ball
                case 87:
                    lPaddleBall.move('up');
                    console.log('w key pressed!');
                    break;

                // key code for down arrow for the left paddle ball
                case 83:
                    lPaddleBall.move('down');
                    console.log('s key pressed!');
                    break;

                // Increase match ball rotation speed with +
                case 187:
                    b1.rotationSpeed += 0.05;
                    break;

                // Decrease match ball rotation speed with -
                case 189:
                    b1.rotationSpeed = Math.max(0, b1.rotationSpeed - 0.05);
                    break;

                //Increase match ball speed with B
                case 66:
                    b1.increaseSpeed();
                    console.log("Ball speed increased: xSpeed=", b1.xSpeed, "ySpeed=", b1.ySpeed);
                    break;

                // change match ball rotation direction with C
                case 67:
                    b1.isRotatingClockwise = !b1.isRotatingClockwise;
                    break;

                //Reset match ball rotation speed and speed to default with R
                case 82:
                    b1.rotationSpeed = 0.1;
                    b1.xSpeed = b1.initialXSpeed;
                    b1.ySpeed = b1.initialYSpeed;
                    break;
            }
        });

    </script>

</body>

</html>